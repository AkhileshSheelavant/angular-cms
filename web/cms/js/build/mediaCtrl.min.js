"use strict";angular.module("cms.controllers").controller("mediaCtrl",["genService","MenuService","$scope","$timeout",function(e,t,n,i){t.update("Media"),n.apiPath="files",n.menuName="Veranstaltung bearbeiten",n.deleteMsg="Löschen",n.loadingFiles=!0,e.getAllObjects("files").then(function(e){n.files=e,i(function(){n.loadingFiles=!1},300)})}]).controller("mediaAddCtrl",["MenuService","$scope","$upload","$window","$location","$timeout","toaster",function(e,t,n,i,r,o,a){e.update("Media"),t.percent=0;var l,s=["jpg","jpeg","png","gif","tiff","svg","doc","ppt","docx","pptx","xls","xlsx","pages","numbers","keynote","pdf","pps","ppsx","odt","txt","mp3","m4a","ogg","wav","mp4","m4v","mkv","mov","wmv","avi","mpg","ogv","3gp","3g2"];t.onFileSelect=function(e){var p=e[0];t.altDescription=p.name.replace(/[ \t\r\n\v\f]/g," ");var c=p.name.split("."),d=c[c.length-1];return t.file.description?-1===s.indexOf(d)?void a.pop("error",null,'Der Dateityp "'+d+'" ist aus Sicherheitsgründen nicht erlaubt'):void(t.upload=n.upload({url:"/api/files",method:"POST",transformRequest:angular.identity,headers:{"Content-Type":void 0},data:{description:t.file.description},file:p}).progress(function(e){var n=parseInt(100*e.loaded/e.total,10);t.percent=n,i.document.getElementsByClassName("progress-bar-percentage")[0].style.width=n+"%"}).success(function(){a.pop("success",null,"Die Datei wurde erfolgreich hochgeladen"),l=o(function(){r.path("/files")},1e3)}).error(function(e,t){409===t?a.pop("error",null,"Eine Datei mit dem gleichen Namen exisitiert bereits"):a.pop("error",null,"Der Upload konnte nicht ausgeführt werden.")})):void a.pop("error",null,"Die Dateibeschreibung muss angegeben werden")},t.$on("$locationChangeStart",function(){o.cancel(l)})}]);