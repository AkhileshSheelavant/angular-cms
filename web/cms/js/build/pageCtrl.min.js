"use strict";angular.module("cms.controllers").controller("pageCtrl",["genService","MenuService","$scope","$timeout",function(e,t,a,i){t.update("Artikel"),a.apiPath="pages",a.deleteMsg="Löschen",a.loadingPages=!0,e.getAllObjects("pages").then(function(e){a.pages=e,i(function(){a.loadingPages=!1},300)})}]).controller("pageDetailCtrl",["genService","MenuService","$scope","$routeParams","$timeout","$location","toaster",function(e,t,a,i,n,r,l){var g,s=[],c=0;t.update("Artikel"),a.apiPath="pages",a.menuName="Seite bearbeiten",a.deleteMsg="Löschen",e.getObjectById("pages",i.pageId).then(function(e){for(e||(l.pop("error",null,"Uups. Die angeforderte Seite exisitert nicht (mehr)."),r.path("/pages")),a.page=e,c=0;c<a.page.articles.length;c++)s.push(a.page.articles[c].id);a.$parent.isLocked=a.page.is_locked?!0:!1,a.$parent.isLockedMessage="Deine Seite wird momentan bearbeitet. Trotzdem weiterfahren?"}),e.getAllObjects("languages").then(function(e){a.allLanguages=e}),e.getAllObjects("pageCategories").then(function(e){a.allPageCategories=e}),e.getAllObjects("articles").then(function(e){for(a.allArticles=[],c=0;c<e.length;c++)-1===s.indexOf(e[c].id)&&a.allArticles.push(e[c])}),a.removeArticleFromPage=function(e){var t=0;for(c=0;c<a.page.articles.length;c++)if(a.page.articles[c].id===e){t=c;break}var i=a.page.articles.splice(t,1);a.allArticles.push(i[0])},a.addArticleToPage=function(e){var t=0;for(c=0;c<a.allArticles.length;c++)if(a.allArticles[c].id===e){t=c;break}var i=a.allArticles.splice(t,1);a.page.articles.push(i[0])},a.savePage=function(t){var i=0;if(!t.title)return void l.pop("warning","Titel","Der Titel für die Seite muss angegeben werden");for(i in t.articles)t.articles.hasOwnProperty(i)&&angular.isString(t.articles[i])&&(t.articles[i]=JSON.parse(t.articles[i]));angular.isString(t.language)&&(t.language=JSON.parse(t.language)),angular.isString(t.category)&&(t.category=JSON.parse(t.category)),a.loading=!0,e.updateObject("pages",t).then(function(){l.pop("success",null,"Menüseite wurde aktualisiert"),g=n(function(){r.path("/pages"),a.loading=!1},2500)})},a.$on("$locationChangeStart",function(){n.cancel(g)})}]).controller("pageAddCtrl",["genService","MenuService","$scope","$location","$timeout","toaster",function(e,t,a,i,n,r){t.update("Artikel");var l,g=[],s=0;a.apiPath="pages",a.menuName="Seite hinzufügen",e.getEmptyObject("page").then(function(e){for(e||(r.pop("error",null,"Uups. Die angeforderte Seite exisitert nicht (mehr)."),i.path("/pages")),a.page=e,s=0;s<a.page.articles.length;s++)g.push(a.page.articles[s].id);a.$parent.isLocked=a.page.is_locked?!0:!1,a.$parent.isLockedMessage="Deine Seite wird momentan bearbeitet. Trotzdem weiterfahren?"}),e.getAllObjects("languages").then(function(e){a.allLanguages=e}),e.getAllObjects("pageCategories").then(function(e){a.allPageCategories=e}),e.getAllObjects("articles").then(function(e){for(a.allArticles=[],s=0;s<e.length;s++)-1===g.indexOf(e[s].id)&&a.allArticles.push(e[s])}),a.removeArticleFromPage=function(e){var t=0;for(s=0;s<a.page.articles.length;s++)if(a.page.articles[s].id===e){t=s;break}var i=a.page.articles.splice(t,1);a.allArticles.push(i[0])},a.addArticleToPage=function(e){var t=0;for(s=0;s<a.allArticles.length;s++)if(a.allArticles[s].id===e){t=s;break}var i=a.allArticles.splice(t,1);a.page.articles.push(i[0])},a.savePage=function(t){return t.title?(angular.isString(t.language)&&(t.language=JSON.parse(t.language)),angular.isString(t.category)&&(t.category=JSON.parse(t.category)),a.loading=!0,void e.insertObject("pages",t).then(function(){r.pop("success",null,"Menüseite wurde hinzugefügt"),l=n(function(){i.path("/pages"),a.loading=!1},2500)})):void r.pop("warning","Titel","Der Titel für die Seite muss angegeben werden")},a.$on("$locationChangeStart",function(){n.cancel(l)})}]);