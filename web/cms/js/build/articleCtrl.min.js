"use strict";angular.module("cms.controllers").controller("articleCtrl",["genService","MenuService","$scope","$timeout",function(e,t,n,i){t.update("Artikel"),n.loadingArticles=!0,e.getAllObjects("articles").then(function(e){n.articles=e,i(function(){n.loadingArticles=!1},300)})}]).controller("articleDetailCtrl",["genService","MenuService","$scope","$routeParams","$timeout","$location","toaster","localStorageService",function(e,t,n,i,a,r,l,c){t.update("Artikel");var o,u;n.apiPath="articles",n.menuName="Artikel bearbeiten",n.deleteMsg="Löschen",n.article={},n.article.content="",e.getObjectById("articles",i.articleId).then(function(e){e||(l.pop("error",null,"Uups. Der angeforderte Artikel exisitert nicht (mehr)."),r.path("/articles")),n.article=e,n.$parent.isLocked=n.article.is_locked_by?!0:!1,n.$parent.isLockedMessage="Dein Artikel wird momentan bearbeitet. Trotzdem weiterfahren?",c.isSupported&&(c.get("article_content_"+n.article.id)&&(u=c.get("article_content_"+n.article.id),u!==n.article.content&&l.pop("info",null,"Es gibt noch eine ungespeicherte Variante deines Artikels. Soll diese geladen werden?",15e3,null,function(){n.article.content=u})),n.$watch("article.content",function(e){c.set("article_content_"+n.article.id,e)}))}),e.getAllObjects("languages").then(function(e){n.allLanguages=e}),e.getAllObjects("articleCategories").then(function(e){n.allArticleCategories=e}),n.saveArticle=function(t){return t.title?(angular.isString(t.language)&&(t.language=JSON.parse(t.language)),angular.isString(t.category)&&(t.category=JSON.parse(t.category)),n.loading=!0,void e.updateObject(n.apiPath,t).then(function(){l.pop("success",null,"Artikel wurde aktualisiert"),o=a(function(){r.path(n.apiPath),n.loading=!1},2500)})):void l.pop("warning",null,"Der Titel für den Artikel muss angegeben werden")},n.$on("$locationChangeStart",function(){a.cancel(o)})}]).controller("articleAddCtrl",["genService","MenuService","$scope","$location","$timeout","toaster",function(e,t,n,i,a,r){t.update("Artikel");var l;n.apiPath="articles",n.menuName="Artikel hinzufügen",n.article={},n.article.content="",e.getEmptyObject("article").then(function(e){e||(r.pop("error",null,"Uups. Es konnte kein neuer Artikel erstellt werden"),i.path("/articles")),n.article=e}),e.getAllObjects("languages").then(function(e){n.allLanguages=e}),e.getAllObjects("articleCategories").then(function(e){n.allArticleCategories=e}),n.saveArticle=function(t){return t.title?(angular.isString(t.language)&&(t.language=JSON.parse(t.language)),angular.isString(t.category)&&(t.category=JSON.parse(t.category)),n.loading=!0,void e.insertObject(n.apiPath,t).then(function(){r.pop("success",null,"Artikel wurde aktualisiert"),l=a(function(){i.path(n.apiPath),n.loading=!1},2500)})):void r.pop("warning",null,"Der Titel für den Artikel muss angegeben werden")},n.$on("$locationChangeStart",function(){a.cancel(l)})}]);